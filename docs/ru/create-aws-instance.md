# 2. Создание инстанса AWS

## 2.1 Создание виртуальной машины (инстанса)

### 2.1.0. Запуск пошагового мастера создания инстанса

#### 2.1.0.1. Переход на страницу запуска инстанса 

![Переход на страницу запуска инстанса](/images/ru/instance0.jpg)

#### 2.1.0.2. Запуск пошагового мастера создания инстанса

![Запуск пошагового мастера создания инстанса](/images/ru/instance0_1.jpg)

#### 2.1.0.3. Выбор типа операционной стистемы инстанса

![Выбор типа операционной стистемы](/images/ru/instance0_2.jpg)

### 2.1.1. Выбор типа инстанса
По умолчанию выбран инстанс `t2.micro`, он нам и нужен, просто нажимаем кнопку **Next: Configure Instance Detalis**

![Выбор типа инстанса](/images/ru/instance1.jpg)

### 2.1.2. Настройка параметров инстанса
В дальнейшем мы подключим к нашему инстансу постоянный публичный IP, поэтому на этом этапе мы отключаем автоназначение публичного IP, и нажимаем кнопку **Next: Add Storage**

![Настройка параметров инстанса](/images/ru/instance2.jpg)

### 2.1.3. Подключение хранилища
Указываем размер "жесткого диска". Для наших целей достаточно 16 гигабайт, и нажимаем кнопку **Next: Add Tags**

![Подключение хранилища](/images/ru/instance3.jpg)

### 2.1.4. Настройка тегов
Если бы мы создавали несколько инстансов, то их можно было бы группировать по тегам, для облегчения администрирования. В данном случае эта фукнциональность излишняя, сразу нажимаем кнопку **Next: Configure Security Gorup**

![Настройка тегов](/images/ru/instance4.jpg)

### 2.1.5. Открытие портов
На этом этапе мы настраиваем брандмауэр, открывая нужные порты. Набор открытых портов называется "Группа безопасности" (Security Group). Мы должны создать новую группу безопасности, дать ей имя, описание, добавить порт UDP (Custom UDP Rule), в поле Rort Range необходимо назначить номер порта, из диапазона [динамических портов](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2_TCP_%D0%B8_UDP) 49152—65535. В данном случае я выбрал номер порта 54321.

![Открытие портов](/images/ru/instance5.jpg)

После заполнения необходимых данных, нажимаем на кнопку **Review and Launch**

### 2.1.6. Обзор всех настроек
На данной странице идет обзор всех настроек нашего инстанса, проверяем все ли настройки в порядке, и нажимаем кнопку **Launch**

![Обзор всех настроек](/images/ru/instance6.jpg)

### 2.1.7. Создание ключей доступа
Дальше выходит диалоговое окно, предлагающее либо создать, либо добавить существующий SSH ключ, с помощью которого мы в дальнейшем будет удаленно подключатся к нашему инстансу. Мы выбираем опцию "Create a new key pair" чтобы создать новый ключ. Задаем его имя, и нажимаем кнопку **Download Key Pair**, чтобы скачать созданные ключи. Сохраните их в надежное место на диске локального компьютера. После того как скачали - нажимаете кнопку **Launch Instances**

![Создание ключей доступа](/images/ru/instance7.jpg)

### 2.1.7.1. Сохранение ключей доступа
Здесь показан, этап сохранения созданных ключей из предыдущего шага. После того, как мы нажали кнопку **Download Key Pair**, ключ сохраняется в виде файла сертификата с расширением *.pem. В данном случае я дал ему имя ***wireguard-awskey.pem***

![Сохранение ключей доступа](/images/ru/instance8.jpg)

### 2.1.8. Обзор результатов создания инстанса
Далее мы видим сообщение об успешном запуске только что созданного нами инстанса. Мы можем перейти к списку наших инстансов нажав на кнопку **View instances**

![Обзор результатов создания инстанса](/images/ru/instance9.jpg)

## 2.2. Создание внешнего IP адреса

### 2.2.1. Запуск создания внешнего IP
Дальше нам необходимо создать постоянный внешний IP адрес, через который мы и будем подключатся к нашему VPN серверу. Для этого в навигационной панели в левой части экрана необходимо выбрать пункт **Elastic IPs** из категории ***NETWORK & SECTURITY*** и нажать кнопку **Allocate new address**

![Запуск создания внешнего IP](/images/ru/elasticip1.jpg)

### 2.2.2. Настройка создания внешнего IP
На следующем шаге нам необходима чтобы была включена опция ***Amazon pool*** (включена по умолчанию), и нажимаем на кнопку **Allocate**

![Настройка создания внешнего IP](/images/ru/elasticip2.jpg)

### 2.2.3. Обзор результатов создания внешнего IP адреса
На следующем экране отобразится полученный нами внешний IP адрес. Рекомендуется его запомнить, а лучше даже записать. он нам еще не раз пригодиться в процессе дальнейшей настройки и использования VPN сервера. В данном руководстве в качестве примера я использую IP адрес ***4.3.2.1***. Как записали адрес, нажимаем на кнопку **Close**

![Обзор результатов создания внешнего IP адреса](/images/ru/elasticip3.jpg)

### 2.2.4. Список внешних IP адресов
Далее нам открывается список наших постоянных публичных IP адресов (elastics IP).

![Список внешних IP адресов](/images/ru/elasticip4.jpg)

### 2.2.5. Назначение внешнего IP инстансу
В этом списке мы выбираем полученный нами IP адрес,  и нажимаем правую кнопку мыши, чтобы вызвать выпадающее меню. В нем выбираем пункт **Associate address**, чтобы назначить его ранее созданному нами инстансу. 

![Назначение внешнего IP инстансу](/images/ru/elasticip5.jpg)

### 2.2.6. Настройка назначения внешнего IP
На следующем шаге выбираем из выпадающего списка наш инстанс, и нажимаем кнопку **Associate**

![Настройка назначения внешнего IP](/images/ru/elasticip6.jpg)

### 2.2.7. Обзор результатов назначения внешнего IP
После этого, мы можем увидеть, к нашему постоянному публичному IP адресу привязан наш инстанс и его приватный IP адрес. 

![Обзор результатов назначения внешнего IP](/images/ru/elasticip7.jpg)

Теперь мы можем подключиться к нашему вновь созданному инстансу из вне, со своего компьютера по SSH.
